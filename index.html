<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>SharpNative by afrogeek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">SharpNative</h1>
      <h2 class="project-tagline">A C# to Native Code (C++, D etc...) Transpiler based on Microsoft Roslyn</h2>
      <a href="https://github.com/afrogeek/SharpNative" class="btn">View on GitHub</a>
      <a href="https://github.com/afrogeek/SharpNative/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/afrogeek/SharpNative/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="what-is-sharpnative-" class="anchor" href="#what-is-sharpnative-" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is SharpNative ?</h1>

<p>SharpNative is a tool that generates <strong>Native Code</strong> (D, Soon C++11, Java and Swift) from <strong>C#</strong>.</p>

<p>The idea is to maximize the cross-platform capabilities of C# without being tied to any vendor
or platform. The Emphasis here is on Performance and Readability of the generated D Code. Comments are preserved as well.</p>

<hr>

<p>Example of Generated Code</p>

<p>C#:</p>

<div class="highlight highlight-c#"><pre><span class="pl-k">using</span> System;

<span class="pl-k">class</span> <span class="pl-en">Primes</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">Main</span>()
    {
        <span class="pl-k">var</span> len = <span class="pl-c1">1000000</span>; <span class="pl-c">// This is a comment</span>
        <span class="pl-k">var</span> primes = AddPrimes(len);
        Console.Write(primes);
    }

    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">AddPrimes</span>(<span class="pl-k">int</span> <span class="pl-smi">len</span>)
    {
        <span class="pl-k">var</span> primes = <span class="pl-c1">0</span>;
        <span class="pl-k">for</span> (<span class="pl-k">var</span> i = <span class="pl-c1">2</span>; i &lt; len; i++)
        {
            <span class="pl-k">if</span> (i%<span class="pl-c1">2</span> == <span class="pl-c1">0</span>)
                <span class="pl-k">continue</span>;
            <span class="pl-k">var</span> isPrime = <span class="pl-c1">true</span>;
            <span class="pl-k">for</span> (<span class="pl-k">var</span> j = <span class="pl-c1">2</span>; j*j &lt;= i; j++)
            {
                <span class="pl-k">if</span> (i%j == <span class="pl-c1">0</span>)
                {
                    isPrime = <span class="pl-c1">false</span>;
                    <span class="pl-k">break</span>;
                }
            }
            <span class="pl-k">if</span> (isPrime)
                primes++;
        }
        <span class="pl-k">return</span> primes;
    }

}</pre></div>

<p>D:</p>

<div class="highlight highlight-c++"><pre>module CsRoot.Primes;
import System.Namespace;
import CsRoot.Namespace;

<span class="pl-k">class</span> <span class="pl-en">Primes</span> : NObject
{

    public <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">Main</span>()
    {
      <span class="pl-k">int</span> len = <span class="pl-c1">1000000</span>;
      <span class="pl-c">// This is a comment</span>
      <span class="pl-k">int</span> primes = <span class="pl-c1">AddPrimes</span>(len);
      Console.<span class="pl-c1">Write</span>(primes);
    }

    final <span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">AddPrimes</span>(<span class="pl-k">int</span> len)
    {
      <span class="pl-k">int</span> primes = <span class="pl-c1">0</span>;

      <span class="pl-k">for</span> (<span class="pl-k">int</span> i = <span class="pl-c1">2</span>;i&lt;len;i++)
      {
        <span class="pl-k">if</span>(i%<span class="pl-c1">2</span>==<span class="pl-c1">0</span>)
        {
          <span class="pl-k">continue</span>;
        }
        <span class="pl-k">bool</span> isPrime = <span class="pl-c1">true</span>;

        <span class="pl-k">for</span> (<span class="pl-k">int</span> j = <span class="pl-c1">2</span>;j*j&lt;=i;j++)
        {
          <span class="pl-k">if</span>(i%j==<span class="pl-c1">0</span>)
          {
            isPrime=<span class="pl-c1">false</span>;
            <span class="pl-k">break</span>;
          }
        }
        <span class="pl-k">if</span>(isPrime)
        {
          primes++;
        }
      }
      <span class="pl-k">return</span> primes;
    }

  public override String <span class="pl-en">ToString</span>()
  {
    <span class="pl-k">return</span> <span class="pl-c1">GetType</span>().<span class="pl-smi">FullName</span>;
  }

  public override Type <span class="pl-en">GetType</span>()
  {
    <span class="pl-k">return</span> __TypeOf!(<span class="pl-c1">typeof</span>(<span class="pl-v">this</span>));
  }
}<span class="pl-ii"></span></pre></div>

<hr>

<h3>
<a id="supported-output-languages" class="anchor" href="#supported-output-languages" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Supported Output Languages</strong>
</h3>

<p>The Compiler in its current state only supports D as the output language. (This is due to DMD being an extremely fast compiler, so testing features is fun)</p>

<hr>

<h3>
<a id="performance----these-are-very-unscientific" class="anchor" href="#performance----these-are-very-unscientific" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<strong>Performance</strong> -- <em>These are very unscientific</em>
</h3>

<p>The following are tests taken from CrossNet (one of the first C# to Native compiler efforts)
<strong>Machine:</strong>
-- Macbook Pro Retina (Mid 2012)
-- 2.6Ghz Intel Core i7
-- 16GB  1600 MHz DDR3
Some benchmarks on my Parallels Windows 8 VM: (3GB Ram, 3 Cores) using DMD  with options  <code>-inline -release -m64 -O</code>
and .Net in release mode</p>

<p>|Type Of Test | C# Time (ms) |     D Time (ms)   |  Speed Ratio (C#/D) |
|-------------|:----------:|------:|
|NSieveTest| 18859  |  5450 | 3.46x |
|MatrixTest(MultiDimensional)| 12359  |    22606   |   0.56x |
|MatrixTest(Jagged)| 10156  | 2580 |    3.98x |
|GC Test| 10657   | 57288 |    0.19x |
|Unsafe Test| 32375    | 4752 |    6.81x |
|HeapSort Test| 8671     | 3906 |    2.21x |
|Average |      |  |    <strong>2.87x</strong> |
Due to the produced binaries being native and better optimizations in the DMD, the generated binaries are generally much faster than their C# counterparts. Except when Garbage Collection is concerned, the D GC is much slower than that of .Net (Maybe we can port it to D). Also the current multidimensional array implementation seems lacking in performance.</p>

<hr>

<h3>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Documentation</strong>
</h3>

<p>Unfortunately this is all the documentation the transpiler has at the moment.</p>

<h3>
<a id="requirements----testing" class="anchor" href="#requirements----testing" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Requirements -- Testing</strong>
</h3>

<p>-- Microsoft .Net 4.0 / Mono 3.6 and above.
-- Windows 7 or Later ( The CLI Interface works on Linux and OSX)
-- A Working D Installation  (LDC,DMD or GDC) </p>

<h3>
<a id="requirements----development" class="anchor" href="#requirements----development" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Requirements -- Development</strong>
</h3>

<p>All requirements mentioned above and:
-- Visual Studio 2013 or above
-- Visual D </p>

<h3>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Usage</strong>
</h3>

<p>If you are using the GUI interface(windows) note that DMD should be installed in <code>"C:\\D\\dmd2\\windows\\bin\\"</code> 
For the CLI interface the driver can be invoked in the following manner:</p>

<pre><code>mono ./SharpNative.exe /compiler:pathtodcompiler /dcorlib:/**pathtodcorlib** /source:"pathtosourcefile" /outputtype:exe /dstdlib:pathtophobos /compileroptions:"compileroptions"
</code></pre>

<p><strong>where</strong>:
-- <strong>pathtodcompiler</strong> is the path to a d compiler e.g. <code>/usr/local/bin/ldc</code> on mac osx
-- <strong>pathtodcorlib</strong> is the path to the included basic corlib e.g. <code>/Projects/SharpNative/DCorlib</code>
-- <strong>pathtosourcefile</strong> is the path to the test source file in C#
--<strong>pathtophobos</strong> is the location of phobos in your installation e.g. <code>/usr/local/Cellar/ldc/0.15.0/include/d</code>
--<strong>compileroptions</strong> are the compiler options to pass to dmd/ldc/gdc e.g. <code>-inline -release -m64 -O5 -oq</code></p>

<p>Feature List (Incomplete):</p>

<ul>
<li>  What works: Moved to Dlang … c++ was a headache</li>
<li>  Basic PInvoke</li>
<li>  Arrays including initializers</li>
<li>  Fields/ Properties/Methods with correct hiding semantics</li>
<li>  Properties are better implemented</li>
<li>  String</li>
<li>  Int/Double/Bool</li>
<li>  Classes and Polymorphism … we follow C# model</li>
<li>  Some benchmarks - basic linpack, fannkuch, nbody</li>
<li>  Modules/Namespaces</li>
<li>  Enum - no enum.Parse support yet though</li>
<li>  Iterators are as .Net use enumerators etc … switching arrays to use simple for loop though for performance improvement</li>
<li>  Constructors/Overloads/Base Class calls</li>
<li>  Static Variables/Members/Properties</li>
<li>  Basic System.Math, more implementations required though</li>
<li>  Extension Methods</li>
<li>  Operator Overloading</li>
<li>  Indexers</li>
<li>  Anonymous Classes</li>
<li>  Generics … All current test cases work</li>
<li>  Boxed structs and interface casting for them</li>
<li>  Inner Classes in the form of OuterClass_InnerClass</li>
<li>  Static Constructors</li>
<li>  Explicit Interfaces … current fix is not so pretty though … i.e. IEnumerator.MoveNext becomes IEnumerator.IEnumerator_MoveNext (this allows implementing methods with same name, differently)</li>
<li>  Implicit and Explicit Cast Operators</li>
<li>  String switch … dlang supports this natively :)</li>
<li>  String.Format .. though implementation is very basic</li>
<li>  C# multi dimensional arrays work correctly (even with multi dim syntax :) )… mostly … look at multi test from CrossNet</li>
<li>  Delegates work including multicast (Native delegates through P/Invoke work too)</li>
<li>  Events work as expected … though a bit slower than C#(mono)</li>
</ul>

<p>What Doesn’t Work: (Also Incomplete)</p>

<ul>
<li>  Object initializers in lambdas/loops/fields do very weird things (tm), we need to wrap them in functions (lambda captures)</li>
<li>  Right now compiler does not do any optimizations like final, in, out <a href="https://github.com/pure" class="user-mention">@pure</a> etc …</li>
<li>  Unboxing to Wrong Type doesn't throw exceptions</li>
<li>  Yield - Though an implementation using fibers exists</li>
<li>  Async/Await - Working on an implementation</li>
<li>  Query Expression Syntax for LINQ and general Expressions</li>
<li>  Structs FieldLayout implementation is currently wrong ... to mimic C# a new design is needed.</li>
<li>  Lots of other minor issues not yet documented.</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/afrogeek/SharpNative">SharpNative</a> is maintained by <a href="https://github.com/afrogeek">afrogeek</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

